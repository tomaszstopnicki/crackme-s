# Picker III
Author: LT 'SYREAL' JONES
Category: Reverse Engineering

## Description
> Can you figure out how this program works to get the flag? 
> Connect to the program with netcat: 
> `$ nc saturn.picoctf.net <>`


## Overview:

This time we are given a more interactive version, we have a `func_table` with four options to choose.
The Picker III let us print the table, create new variables, modify value of existing variables and read their values.
The total size of the table is 128 bytes and its validation logic is in `check_table`.
```python
func_table = \

'''\
print_table                     \
read_variable                   \
write_variable                  \
getRandomNumber                 \
'''

USER_ALIVE = True
FUNC_TABLE_SIZE = 4
FUNC_TABLE_ENTRY_SIZE = 32

def check_table():
  global func_table  
  if( len(func_table) != FUNC_TABLE_ENTRY_SIZE * FUNC_TABLE_SIZE):
    return False
  return True
```

The `win` function:
```python
def win():
  # This line will not work locally unless you create your own 'flag.txt' in
  #   the same directory as this script
  flag = open('flag.txt', 'r').read()
  #flag = flag[:-1]
  flag = flag.strip()
  str_flag = ''
  for c in flag:
    str_flag += str(hex(ord(c))) + ' '
  print(str_flag)
```
## Solution 1:


### Access `print_table` and overwrite it with `win`
```console
┌──(kali㉿doubtful)-[~]
└─$ nc saturn.picoctf.net 60957
==> 1
1: print_table
2: read_variable
3: write_variable
4: getRandomNumber
==> 3
Please enter variable name to write: print_table
Please enter new value of variable: win
==> 1
0x70 0x69 0x63 0x6f 0x43 0x54 0x46 0x7b 0x37 0x68 0x31 0x35 0x5f 0x31 0x35 0x5f 0x77 0x68 0x34 0x37 0x5f 0x77 0x33 0x5f 0x67 0x33 0x37 0x5f 0x77 0x31 0x37 0x68 0x5f 0x75 0x35 0x33 0x72 0x35 0x5f 0x31 0x6e 0x5f 0x63 0x68 0x34 0x72 0x67 0x33 0x5f 0x32 0x32 0x36 0x64 0x64 0x32 0x38 0x35 0x7d
```

## Solution 2:
### Modify `func_table` entries while maintaining the table validation check of 128 bytes.

```console
──(kali㉿doubtful)-[~]
└─$ nc saturn.picoctf.net 60957
==> 3
Please enter variable name to write: func_table
Please enter new value of variable: func_table = '''print_table                     win                             write_variable                  print_table                     '''
==> 2
0x70 0x69 0x63 0x6f 0x43 0x54 0x46 0x7b 0x37 0x68 0x31 0x35 0x5f 0x31 0x35 0x5f 0x77 0x68 0x34 0x37 0x5f 0x77 0x33 0x5f 0x67 0x33 0x37 0x5f 0x77 0x31 0x37 0x68 0x5f 0x75 0x35 0x33 0x72 0x35 0x5f 0x31 0x6e 0x5f 0x63 0x68 0x34 0x72 0x67 0x33 0x5f 0x32 0x32 0x36 0x64 0x64 0x32 0x38 0x35 0x7d
```

### Python script to map hexadecimal values into flag:
```console
>>> arr = "0x70 0x69 0x63 0x6f 0x43 0x54 0x46 0x7b 0x37 0x68 0x31 0x35 0x5f 0x31 0x35 0x5f 0x77 0x68 0x34 0x37 0x5f 0x77 0x33 0x5f 0x67 0x33 0x37 0x5f 0x77 0x31 0x37 0x68 0x5f 0x75 0x35 0x33 0x72 0x35 0x5f 0x31 0x6e 0x5f 0x63 0x68 0x34 0x72 0x67 0x33 0x5f 0x32 0x32 0x36 0x64 0x64 0x32 0x38 0x35 0x7d".split()
>>> for c in arr: print(chr(int(c, 16)), end="")
...
picoCTF{7h15_15_wh47_w3_g37_w17h_u53r5_1n_ch4rg3_226dd285}>>>
```